---
title: "Data Exploration Gabriel Hamulic"
subtitle: "Dataset: US Real Estate Dataset"
author: "Hamulic, Gabriel"
date: today
embed-resources: true
format:
  html: 
    output-file: US-Real-Estate_Gabriel_Hamulic.html
    #output-ext: "html.html" 
    toc: true
    toc-location: right
    code-link: true
    code-tools: true
    #df-print: kable
    theme:
      light: flatly
      dark: darkly
    #echo: fenced
  pdf: 
    output-file: US-Real-Estate_Gabriel_Hamulic.pdf 
    toc: true
    number-sections: true
    code-link: true
    df-print: tibble
    crossref: 
      lof-title: "List of Figures"
fig-align: center
execute: 
  warning: false
---

```{=tex}
\listoffigures 
\listoftables
\listoflistings
```

::: callout-caution
### Instructions
Your report must be of high quality, meaning that your report: 

* is visually and textually pleasing of 
* does not look/read/feel like a draft instead of a finished analysis
+ explains/discusses your findings and results in the main text, e.g., explain/discuss all figures/table in the main text 
* is representable such that it can show to any interested third party
* uses figure/table captions/linking/reference (see example further down)
* Do not show any standard printout of R-code, use for data.frame/tibbles `knitr::kable()` printing. 
* Do not simply print datasets (too many lines) use instead `rmarkdown::paged_table()`
:::


{{< pagebreak >}}

# Introduction

## Libraries

```{r}
#| code-summary: Libraries
#| code-fold: true
library <- function(...) {suppressPackageStartupMessages(base::library(...))}
library(tidyverse)
library(dplyr)
library(knitr)
library(tidyr)
library(rmarkdown)
library(janitor)
```

# Data 

## Data source

In this data exploration we are looking at the US Real Estate market with use of a dataset from kaggle published by Ahmed Shahriar Sakib. It contains over 2.2 Million Real Estate listings broken down to State, Size, Price (among other factors). (Source: <https://www.kaggle.com/datasets/ahmedshahriarsakib/usa-real-estate-dataset/data>)


## Data import

::: callout-caution
### Instructions
Download and import your dataset. Assign each variable appropriate/correct data types. Discuss/explain your choice for each variable (groups) in the main text.
:::
```{r setup, include=FALSE}
options(dplyr.print_max = 10, dplyr.print_min = 10)
```


```{r} 
# Import Data
data = read.csv("data/realtor-data.zip.csv")
```

## Data Transformation

```{r} 
# Keep relevant Columns
data = subset(data, select = c(status, price, bed, bath, acre_lot, city, state, house_size))
```

```{r}
str_out <- capture.output(str(data))
kable(data.frame(Output = str_out), col.names = "Structure Output")
```

```{r} 
# Assign Data Types
data$status = as.factor(data$status)
data$city = as.factor(data$city)
data$state = as.factor(data$state)
```

```{r}
str_out <- capture.output(str(data))
kable(data.frame(Output = str_out), col.names = "Structure Output")
```

```{r}
before_rows <- nrow(data)
data <- na.omit(data)
after_rows <- nrow(data)
kable(data.frame(Description = c("Before NA removal", "After NA removal"),
Rows = c(before_rows, after_rows)))
```
The dataset now has `r nrow(data)` observations and `r ncol(data)` variables after removing rows with missing values.

```{r} 
data = data |>
  mutate(price_per_sqm = price/house_size)
```

### Cleaned Dataset
```{r}
paged_table(data)
```


We chose the following data types for our variables:

- 

## Data dictionary

The following variables of the dataset will be looked into:

- price - The price for which the item was listed on the market

- status - The status if the house is already sold or still for sale

- acre_lot - The size of the land / lot on which the house is located in acres

- state - The state in which the house is located

- house size - The size of the house in square feet


# Summary statistic tables

In this section we will cover the summary of our cleaned dataset. We will explore basic statistical values from our data.
## Numeric Statistics

```{r}
#| label: "Numeric Statistics"
#| tbl-cap: "Summary statistics of numerical variables in dataframe"
#| code-fold: true
data |> 
  janitor::clean_names() |>
  mutate(row = row_number() |> factor()) |> 
  pivot_longer(cols = where(is.numeric)) |> 
  group_by(name) |> 
  summarize(N = n(),
            min = min(value),
            mean = mean(value),
            median = median(value),
            max = max(value),
            st.dev = sd(value)
            ) |> 
  knitr::kable(digits = 2)
```

## Nominal Statistics
```{r}
#| label: "Nominal Statistics"
#| tbl-cap: "Top categories for factor variables with counts, proportions, and mean price"
#| code-fold: true

top_n_per_var <- 10  # adjustable

nominal_summary <- data  |>
  janitor::clean_names()  |>
  select(where(is.factor), price)  |>
  pivot_longer(cols = where(is.factor),
               names_to = "Variable",
               values_to = "Category")  |>
  group_by(Variable, Category)  |>
  summarise(
    Count = n(),
    Percent = round(100 * Count / nrow(data), 2),
    Mean_Price = round(mean(price, na.rm = TRUE), 0),
    .groups = "drop"
  )  |>
  group_by(Variable)  |>
  slice_max(order_by = Count, n = top_n_per_var, with_ties = FALSE)  |>
  ungroup()

kable(
  nominal_summary,
  caption = paste0(
    "Top ", top_n_per_var,
    " categories per factor variable (counts, share %, and mean price)"
  ),
  digits = 2,
  align = c("l", "l", "r", "r", "r")
)
```

# Data visualisations

::: callout-caution
### Instructions
Visually explore your data. 
:::

# Summary

::: callout-caution
### Instructions
Summarise your finding. 
:::