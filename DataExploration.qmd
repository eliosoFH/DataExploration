---
title: "Data Exploration Gabriel Hamulic"
subtitle: "Dataset: US Real Estate Dataset"
author: "Hamulic, Gabriel"
date: today
embed-resources: true
format:
  html: 
    output-file: US-Real-Estate_Gabriel_Hamulic.html
    #output-ext: "html.html" 
    toc: true
    toc-location: right
    code-link: true
    code-tools: true
    #df-print: kable
    theme:
      light: flatly
      dark: darkly
    #echo: fenced
  pdf: 
    output-file: US-Real-Estate_Gabriel_Hamulic.pdf 
    toc: true
    number-sections: true
    code-link: true
    df-print: tibble
    crossref: 
      lof-title: "List of Figures"
fig-align: center
execute: 
  warning: false
---

```{=tex}
\listoffigures 
\listoftables
\listoflistings
```

::: callout-caution
### Instructions
Your report must be of high quality, meaning that your report: 

* is visually and textually pleasing of 
* does not look/read/feel like a draft instead of a finished analysis
+ explains/discusses your findings and results in the main text, e.g., explain/discuss all figures/table in the main text 
* is representable such that it can show to any interested third party
* uses figure/table captions/linking/reference (see example further down)
* Do not show any standard printout of R-code, use for data.frame/tibbles `knitr::kable()` printing. 
* Do not simply print datasets (too many lines) use instead `rmarkdown::paged_table()`
:::


{{< pagebreak >}}

# Introduction

## Libraries

```{r}
#| code-summary: Libraries
#| code-fold: true
library <- function(...) {suppressPackageStartupMessages(base::library(...))}
library(tidyverse)
library(dplyr)
library(knitr)
library(rmarkdown)
```

# Data 

## Data source

In this data exploration we are looking at the US Real Estate market with use of a dataset from kaggle published by Ahmed Shahriar Sakib. It contains over 2.2 Million Real Estate listings broken down to State, Size, Price (among other factors). (Source: <https://www.kaggle.com/datasets/ahmedshahriarsakib/usa-real-estate-dataset/data>)


## Data import

::: callout-caution
### Instructions
Download and import your dataset. Assign each variable appropriate/correct data types. Discuss/explain your choice for each variable (groups) in the main text.
:::
```{r setup, include=FALSE}
options(dplyr.print_max = 10, dplyr.print_min = 10)
```


```{r} 
# Import Data
data = read.csv("data/realtor-data.zip.csv")
```

## Data Transformation

```{r} 
# Keep relevant Columns
data = subset(data, select = c(status, price, bed, bath, acre_lot, city, state, house_size))
```

```{r}
str_out <- capture.output(str(data))
kable(data.frame(Output = str_out), col.names = "Structure Output")
```

```{r} 
# Assign Data Types
data$status = as.factor(data$status)
data$city = as.factor(data$city)
data$state = as.factor(data$state)
```

```{r}
str_out <- capture.output(str(data))
kable(data.frame(Output = str_out), col.names = "Structure Output")
```

```{r}
before_rows <- nrow(data)
data <- na.omit(data)
after_rows <- nrow(data)
kable(data.frame(Description = c("Before NA removal", "After NA removal"),
Rows = c(before_rows, after_rows)))
```
The dataset now has `r nrow(data)` observations and `r ncol(data)` variables after removing rows with missing values.

```{r} 
data = data |>
  mutate(price_per_sqm = price/house_size)
```

### Cleaned Dataset
```{r}
paged_table(data)
```


We chose the following data types for our variables:

- 

## Data dictionary

The following variables of the dataset will be looked into:

- price - The price for which the item was listed on the market

- status - The status if the house is already sold or still for sale

- acre_lot - The size of the land / lot on which the house is located in acres

- state - The state in which the house is located

- house size - The size of the house in square feet


# Summary statistic tables

::: callout-caution
### Instructions
Make summary statistics of your data.

::: {.panel-tabset}

## Numeric iris

@tbl-summary-num-tidyverse-iris shows for the numerical variables in the iris dataset some summary statistics.

```{r}
#| label: "tbl-summary-num-tidyverse-iris"
#| tbl-cap: "Summary statistics of numerical variables in `datasets::iris` with tidyverse (ungrouped)"
#| code-fold: true
iris |> 
  janitor::clean_names() |>
  mutate(row = row_number() |> factor()) |> 
  pivot_longer(cols = where(is.numeric)) |> 
  group_by(name) |> 
  summarize(N = n(),
            min = min(value),
            mean = mean(value),
            median = median(value),
            max = max(value),
            st.dev = sd(value)
            ) |> 
  knitr::kable(digits = 2)
```



## Numeric iris grouped

@tbl-summary-num-tidyverse-iris-Species shows for the numerical variables in the iris dataset grouped summary statistics for different Species.

```{r}
#| label: "tbl-summary-num-tidyverse-iris-Species"
#| tbl-cap: "Summary statistics of numerical variables in `datasets::iris` with tidyverse grouped by Species"
#| code-fold: true
iris |> 
  janitor::clean_names() |>
  mutate(row = row_number() |> as.character()) |> 
  pivot_longer(cols = where(is.numeric)) |> 
  group_by(name, species) |> 
  summarize(N = n(),
            min = min(value),
            mean = mean(value),
            median = median(value),
            max = max(value),
            st.dev = sd(value)
            ) |> 
  knitr::kable(digits = 2)
```

## Nominal iris

@tbl-summary-fct-tidyverse-iris shows summary statistics for the iris factor variables.

```{r}
#| label: "tbl-summary-fct-tidyverse-iris"
#| tbl-cap: "Summary statistics of factor variables in `datasets::iris` with tidyverse."
#| code-fold: true

iris |> 
  janitor::clean_names() |>
  mutate(row = row_number() |> as.character()) |> 
  select(where(is.factor)) |> 
  pivot_longer(cols = where(is.factor)) |> 
  group_by(name) |> 
  count(value) |> 
  ungroup() |> 
  arrange(desc(name), n) |> 
  knitr::kable(digits = 2)
```

## Nominal penguins

@tbl-summary-fct-tidyverse-penguins shows summary statistics for the iris factor variables.s and penguins factor variables.

```{r}
#| label: "tbl-summary-fct-tidyverse-penguins"
#| tbl-cap: "Summary statistics of factor variables in `palmerpenguins::penguins` with tidyverse."
#| code-fold: true

data("penguins", package="palmerpenguins")
penguins |> 
  janitor::clean_names() |>
  mutate(row = row_number() |> as.character()) |> 
  select(where(is.factor)) |> 
  pivot_longer(cols = where(is.factor)) |> 
  group_by(name) |> 
  count(value) |> 
  ungroup() |> 
  arrange(desc(name), n) |> #dput()
  knitr::kable(digits = 2)
```

## All variable statistics

@tbl-Base-R-All-Variables shows summary statistics applicable to different data type.

```{r}
#| code-fold: true
#| code-summary: Load and specify dataset
# specify full dataset
data_all <- iris
data_all <- palmerpenguins::penguins

## numerical data
data_num <- data_all[sapply(data_all, is.numeric)]
data_num <- subset(data_all, select = sapply(data_all,is.numeric))
data_num <- data_all |> select(where(is.numeric))

## nominal data
data_nom <- data_all[!sapply(data_all, is.numeric)]
data_chr <- data_all[sapply(data_all, is.character)]
data_lgl <- data_all[sapply(data_all, is.logical)]
data_fct <- data_all[sapply(data_all, is.factor)]
```


```{r}
#| label: tbl-Base-R-All-Variables
#| tbl-cap: "Base R statistics applicable to all variables"
#| code-fold: true
data.frame(
  #var = names(data_all),
  n_obs = sapply(data_all, function(.) length(na.omit(.)))
  ,n_all = sapply(na.omit(data_all), length)
  ,n_missing = sapply(data_all, function(.) sum(is.na(.)))
  ,mode = data_all |> sapply(mode)
  ,class = data_all |> sapply(class)
) |> #as_tibble() |> 
  knitr::kable()
```


## Numerical data

```{r}
#| code-fold: true
library(tidyverse)
## n_obs individual by variables
## n_all all variables have same n observations

library(tidyverse)
data.frame(
  var = names(data_num),
  n_obs = sapply(data_num, function(.) length(na.omit(.)))
  ,n_all = sapply(na.omit(data_num), length)
  ,min = sapply(data_num, function(.) min(na.omit(.)))
  ,min_all = sapply(na.omit(data_num), min)
  ,mean = sapply(data_num, function(.) mean(na.omit(.)))
  ,mean_all = sapply(na.omit(data_num), mean)
  ,median = sapply(data_num, function(.) median(na.omit(.)))
  ,median_all = sapply(na.omit(data_num), median)
  ,max = sapply(data_num, function(.) max(na.omit(.)))
  ,max_all = sapply(na.omit(data_num), max)
  ,sd = sapply(data_num, function(.) sd(na.omit(.)))
  ,sd_all = sapply(na.omit(data_num), sd)
) |> 
  as_tibble() |> 
  select(!contains("_all")) |> 
  knitr::kable(digits = 2)
```


## print
```{r}
rmarkdown::paged_table(iris)
```
:::
:::

# Data visualisations

::: callout-caution
### Instructions
Visually explore your data. 
:::

# Summary

::: callout-caution
### Instructions
Summarise your finding. 
:::